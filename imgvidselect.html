<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Media Selector/Uploader</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <link href="https://releases.transloadit.com/uppy/v4.13.3/uppy.min.css" rel="stylesheet" />
  <style>
    .uppy-Dashboard { width: 100% !important; max-width: 100% !important; height: auto !important; }
    .uppy-Dashboard-inner { width: 100% !important; max-width: none !important; height: auto !important; min-height: 450px !important; }
    .uppy-Dashboard-innerWrap { width: 100% !important; }
    [data-uppy-theme="light"] { width: 100% !important; }
    #drag-drop-area { width: 100% !important; }
  </style>
</head>
<body class="bg-gray-100 p-6">
  <div x-data="mediaDialog()" class="max-w-md mx-auto bg-white rounded-lg shadow-lg">
    <div class="flex border-b">
      <button :class="tab==='image'?active:''" @click="tab='image'" class="flex-1 py-2 text-center">Image</button>
      <button :class="tab==='video'?active:''" @click="tab='video'" class="flex-1 py-2 text-center">Video</button>
      <button :class="tab==='upload'?active:''" @click="tab='upload'" class="flex-1 py-2 text-center">Upload</button>
    </div>
    <div class="p-4">
      <div x-show="tab==='image'">
        <input x-model="query" @keydown.enter="searchImages()" type="text" placeholder="Search images..." class="w-full px-3 py-2 border rounded" />
        <div class="mt-4 grid grid-cols-3 gap-2">
          <template x-for="img in images" :key="img.id">
            <div class="border rounded overflow-hidden"><img :src="img.src" alt="" class="object-cover h-24 w-full" /></div>
          </template>
        </div>
      </div>
      <div x-show="tab==='video'">
        <input x-model="query" @keydown.enter="searchVideos()" type="text" placeholder="Search videos..." class="w-full px-3 py-2 border rounded" />
        <div class="mt-4 grid grid-cols-1 gap-4">
          <template x-for="vid in videos" :key="vid.id">
            <div class="border rounded overflow-hidden"><video :src="vid.src" controls class="w-full h-32"></video></div>
          </template>
        </div>
      </div>
      <div x-show="tab==='upload'">
        <div class="card p-0 overflow-hidden"><div id="drag-drop-area"></div></div>
      </div>
    </div>
  </div>

  <script src="https://releases.transloadit.com/uppy/v4.13.3/uppy.min.js"></script>
  <script src="https://releases.transloadit.com/uppy/locales/v3.3.1/da_DK.min.js"></script>
  <script>
    window.UPLOAD_API_KEY = 'whateverkey';
    window.REGION = 'east';
    window.USER = 'sope@tv2reg.dk';
    const photographers = [
      { id: '8c92f1c8-4eee-4d0b-8a76-c405d713d05d', title: 'søren' },
      { id: '1323e293-b4b3-4ec1-bc69-a7f2168508aa', title: 'michael' },
      { id: '1c3b017f-5c3a-445a-a37c-e71e3fa96673', title: 'morten' },
      { id: '9bb4aab2-3bc2-45d3-9986-469e5e7695be', title: 'lisa' },
      { id: '11b14d02-9629-4e8e-b35e-9a29ad69b5a0', title: 'marianne' },
      { id: 'd105dc17-b1d0-4ca6-b156-6b4b11ecd020', title: 'ritzau' }
    ];

    function mediaDialog() {
      return {
        tab: 'image',
        query: '',
        images: [],
        videos: [],
        active: 'border-b-2 border-blue-500 text-blue-600',
        uppyInitialized: false,
        init() {
          this.searchImages();
          this.searchVideos();
          this.$watch('tab', value => {
            if (value === 'upload' && !this.uppyInitialized) {
              this.initUppy();
              this.uppyInitialized = true;
            }
          });
        },
        initUppy() {
          const uppy = new Uppy.Uppy({
            restrictions: { requiredMetaFields: ['title', 'caption'] },
            meta: { title: '', caption: '', photographer: '', region: window.REGION, user: window.USER },
            locale: Uppy.locales.da_DK
          })
          .use(Uppy.Compressor)
          .use(Uppy.Dashboard, {
            inline: true,
            height: 600,
            target: '#drag-drop-area',
            showProgressDetails: true,
            proudlyDisplayPoweredByUppy: false,
            width: '100%',
            metaFields: [
              { id: 'title', name: 'Titel', placeholder: 'Indtast titel' },
              { id: 'caption', name: 'Billedtekst', placeholder: 'Indtast billedtekst' },
              {
                id: 'photographer',
                name: 'Fotograf',
                render: ({ value, onChange, fieldCSSClasses }, h) => {
                  return h('select', {
                    class: fieldCSSClasses.text,
                    value,
                    name: 'photographer',
                    onChange: e => onChange(e.target.value),
                    'data-uppy-super-focusable': true
                  }, [
                    h('option', { value: '' }, 'Vælg fotograf'),
                    ...photographers.map(p =>
                      h('option', { value: p.id, selected: p.id === value }, p.title)
                    )
                  ]);
                }
              }
            ]
          })
          .use(Uppy.AwsS3, { endpoint: 'https://tools-uppy.nwrasl.easypanel.host/', headers: { 'X-Upload-Key': window.UPLOAD_API_KEY } });

          uppy.on('complete', result => console.log('Upload fuldført! Resultater:', result));
        },
        searchImages() {
          this.images = Array.from({ length: 9 }, (_, i) => ({
            id: i,
            src: `https://placehold.co/150?text=Img+${i+1}`
          }));
        },
        searchVideos() {
          this.videos = Array.from({ length: 3 }, (_, i) => ({
            id: i,
            src: `https://www.w3schools.com/html/mov_bbb.mp4#t=${i}`
          }));
        }
      }
    }
    document.addEventListener('alpine:init', () => Alpine.data('mediaDialog', mediaDialog));
  </script>
</body>
</html>
