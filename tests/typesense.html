<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Typesense Search with Tailwind & Pagination</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Typesense client -->
    <script src="https://cdn.jsdelivr.net/npm/typesense@2/dist/typesense.min.js"></script>
  </head>
  <body class="bg-gray-50">
    <div class="max-w-3xl mx-auto p-6">
      <h1 class="text-3xl font-bold text-gray-800 mb-6">TV MidtVest Search</h1>
      
      <!-- Search Form -->
      <form id="search-form" class="mb-6 flex space-x-2">
        <input
          type="text"
          id="search-input"
          placeholder="Enter search query"
          required
          class="flex-1 px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
          Search
        </button>
      </form>
      
      <!-- Results Container -->
      <div id="results" class="space-y-4">
        <p class="text-gray-600">Please enter a query to search.</p>
      </div>
    </div>

    <script>
      // Global variables
      let currentQuery = '';
      const perPage = 10; // results per page

      // Create a new Typesense client instance
      const client = new Typesense.Client({
        nodes: [
          {
            host: 'ubd8iz2nk1536tf9p-1.a1.typesense.net', // Your Typesense server host
            port: 443, // Your server port
            protocol: 'https' // Protocol to use
          }
        ],
        apiKey: 'jUVuMLjf7CCgV2ZVHRsfd5kgNex8oyL4' // Your Typesense API key
      });

      // Render the search results and pagination
      function renderResults(searchResults) {
        const resultsContainer = document.getElementById('results');
        resultsContainer.innerHTML = '';

        // If no hits, display a message
        if (searchResults.hits.length === 0) {
          resultsContainer.innerHTML = '<p class="text-gray-600">No results found.</p>';
          return;
        }

        // Create list of results
        const ul = document.createElement('ul');
        ul.className = "divide-y divide-gray-200";

        searchResults.hits.forEach(hit => {
          const doc = hit.document;
          const li = document.createElement('li');
          li.className = "py-4";

          // Remove "entry::" prefix from the id
          const nodeId = doc.id.replace(/^entry::/, '');

          // Create clickable title using full_title and link to the correct node URL
          const titleLink = document.createElement('a');
          titleLink.href = `https://www.tvmidtvest.dk/node/${nodeId}`;
          titleLink.target = "_blank";
          titleLink.className = "text-xl font-semibold text-blue-600 hover:underline";
          titleLink.textContent = doc.full_title || "Untitled";

          // Create a paragraph for summary
          const summaryPara = document.createElement('p');
          summaryPara.className = "text-gray-700 mt-1";
          summaryPara.textContent = doc.summary || "";

          li.appendChild(titleLink);
          li.appendChild(summaryPara);
          ul.appendChild(li);
        });

        resultsContainer.appendChild(ul);

        // Render pagination controls
        const totalPages = Math.ceil(searchResults.found / perPage);
        const currentPage = searchResults.page || 1;
        const paginationControls = renderPagination(currentPage, totalPages);
        resultsContainer.appendChild(paginationControls);
      }

      // Render pagination controls using Tailwind classes
      function renderPagination(currentPage, totalPages) {
        const paginationContainer = document.createElement('div');
        paginationContainer.className = "mt-6 flex items-center justify-center space-x-4";

        if (currentPage > 1) {
          const prevButton = document.createElement('button');
          prevButton.textContent = 'Previous';
          prevButton.className = "px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300";
          prevButton.addEventListener('click', () => performSearch(currentQuery, currentPage - 1));
          paginationContainer.appendChild(prevButton);
        }

        const pageInfo = document.createElement('span');
        pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
        pageInfo.className = "text-gray-600";
        paginationContainer.appendChild(pageInfo);

        if (currentPage < totalPages) {
          const nextButton = document.createElement('button');
          nextButton.textContent = 'Next';
          nextButton.className = "px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300";
          nextButton.addEventListener('click', () => performSearch(currentQuery, currentPage + 1));
          paginationContainer.appendChild(nextButton);
        }

        return paginationContainer;
      }

      // Perform search using the provided query and page number
      function performSearch(query, page = 1) {
        currentQuery = query;
        document.getElementById('results').innerHTML = '<p class="text-gray-600">Loading results...</p>';

        client
          .collections('public')
          .documents()
          .search({
            q: query,
            preset: 'public',
            page: page,
            per_page: perPage
          })
          .then(searchResults => {
            console.log('Search Results:', searchResults);
            renderResults(searchResults);
          })
          .catch(error => {
            console.error('Search error:', error);
            document.getElementById('results').innerHTML = '<p class="text-red-600">Error loading results.</p>';
          });
      }

      // Event listener for search form submission
      document.getElementById('search-form').addEventListener('submit', function (event) {
        event.preventDefault();
        const query = document.getElementById('search-input').value;
        performSearch(query, 1);
      });
    </script>
  </body>
</html>
