<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Typesense Search with Pagination</title>
    <script src="https://cdn.jsdelivr.net/npm/typesense@2/dist/typesense.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      h1 {
        color: #333;
      }
      .search-container {
        margin-bottom: 20px;
      }
      .search-input {
        padding: 8px;
        font-size: 1em;
        width: 250px;
        margin-right: 10px;
      }
      .search-button {
        padding: 8px 16px;
        font-size: 1em;
      }
      #results {
        margin-top: 20px;
      }
      .result-item {
        border-bottom: 1px solid #ccc;
        padding: 10px 0;
      }
      .result-item:last-child {
        border-bottom: none;
      }
      .result-title {
        font-weight: bold;
        font-size: 1.2em;
        margin: 0;
      }
      .result-details {
        color: #555;
        margin: 5px 0 0;
      }
      #pagination {
        margin-top: 20px;
      }
      #pagination button {
        padding: 6px 12px;
        margin: 0 5px;
        font-size: 1em;
      }
    </style>
  </head>
  <body>
    <h1>Typesense Search with Pagination</h1>
    <div class="search-container">
      <form id="search-form">
        <input
          type="text"
          id="search-input"
          class="search-input"
          placeholder="Enter search query"
          required
        />
        <button type="submit" class="search-button">Search</button>
      </form>
    </div>
    <div id="results">Please enter a query to search.</div>
    <script>
      // Global variables
      let currentQuery = '';
      const perPage = 10; // Number of results per page

      // Create a new Typesense client instance
      const client = new Typesense.Client({
        nodes: [
          {
            host: 'ubd8iz2nk1536tf9p-1.a1.typesense.net', // Your Typesense server host
            port: 443, // Your server port
            protocol: 'https' // Protocol to use
          }
        ],
        apiKey: 'jUVuMLjf7CCgV2ZVHRsfd5kgNex8oyL4' // Your Typesense API key
      });

      // Function to render search results and pagination controls
      function renderResults(searchResults) {
        const resultsContainer = document.getElementById('results');
        resultsContainer.innerHTML = ''; // Clear previous results

        if (searchResults.hits.length === 0) {
          resultsContainer.innerHTML = '<p>No results found.</p>';
          return;
        }

        // Create a list to display the search results
        const ul = document.createElement('ul');
        ul.style.listStyleType = 'none';
        ul.style.padding = '0';

        searchResults.hits.forEach(hit => {
          const doc = hit.document;
          const li = document.createElement('li');
          li.classList.add('result-item');

          // Adjust the fields below as needed based on your document structure
          li.innerHTML = `
            <p class="result-title">${doc.title || 'Untitled'}</p>
            <p class="result-details">${doc.author ? 'by ' + doc.author : ''}</p>
          `;
          ul.appendChild(li);
        });
        resultsContainer.appendChild(ul);

        // Calculate pagination info based on the total results and perPage setting
        const totalPages = Math.ceil(searchResults.found / perPage);
        const currentPage = searchResults.page || 1;

        // Append pagination controls if needed
        const paginationControls = renderPagination(currentPage, totalPages);
        resultsContainer.appendChild(paginationControls);
      }

      // Function to render pagination controls (Previous and Next buttons)
      function renderPagination(currentPage, totalPages) {
        const paginationContainer = document.createElement('div');
        paginationContainer.id = 'pagination';

        if (currentPage > 1) {
          const prevButton = document.createElement('button');
          prevButton.textContent = 'Previous';
          prevButton.addEventListener('click', function () {
            performSearch(currentQuery, currentPage - 1);
          });
          paginationContainer.appendChild(prevButton);
        }

        const pageInfo = document.createElement('span');
        pageInfo.textContent = ' Page ' + currentPage + ' of ' + totalPages + ' ';
        paginationContainer.appendChild(pageInfo);

        if (currentPage < totalPages) {
          const nextButton = document.createElement('button');
          nextButton.textContent = 'Next';
          nextButton.addEventListener('click', function () {
            performSearch(currentQuery, currentPage + 1);
          });
          paginationContainer.appendChild(nextButton);
        }

        return paginationContainer;
      }

      // Function to perform a search using the provided query and page number
      function performSearch(query, page = 1) {
        currentQuery = query;
        document.getElementById('results').innerHTML = '<p>Loading results...</p>';

        client
          .collections('public')
          .documents()
          .search({
            q: query,
            preset: 'public',
            page: page,
            per_page: perPage
          })
          .then(function (searchResults) {
            console.log('Search Results:', searchResults);
            renderResults(searchResults);
          })
          .catch(function (error) {
            console.error('Search error:', error);
            document.getElementById('results').innerHTML = '<p>Error loading results.</p>';
          });
      }

      // Event listener for the search form submission
      document.getElementById('search-form').addEventListener('submit', function (event) {
        event.preventDefault(); // Prevent form from submitting normally
        const query = document.getElementById('search-input').value;
        performSearch(query, 1);
      });
    </script>
  </body>
</html>
