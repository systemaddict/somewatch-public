<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inline Uppy Dashboard with Transloadit</title>
    <!-- Pull Uppy from CDN -->
    <link href="https://releases.transloadit.com/uppy/v4.13.3/uppy.min.css" rel="stylesheet" />
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #2275d7;
        }
        .upload-container {
            margin: 30px 0;
        }
        .results {
            margin-top: 20px;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>Uppy + Transloadit</h1>
    <p>The dashboard appears inline without requiring a button click.</p>
    
    <!-- This div is where the inline Dashboard will appear -->
    <div id="uppy-dashboard" class="upload-container"></div>
    
    <!-- Results area for debugging -->
    <div id="results" class="results">Results will appear here after upload...</div>
    
    <script type="module">
        import {
            Uppy,
            Dashboard,
            ImageEditor,
            RemoteSources,
            Transloadit,
        } from 'https://releases.transloadit.com/uppy/v4.13.3/uppy.min.mjs'
        
        const resultsElement = document.getElementById('results');
        
        const uppy = new Uppy()
            .use(Transloadit, {
                waitForEncoding: true,
                alwaysRunAssembly: true,
                assemblyOptions: {
                    params: {
                        template_id: '8244d6bc4eb44148910bf1d493d67b8b',
                        // To avoid tampering, use Signature Authentication:
                        // https://transloadit.com/docs/api/authentication/
                        auth: {
                            key: 'tv2reg',
                        },
                    },
                },
            })
            .use(Dashboard, {
                inline: true,                // This makes it appear without a click
                target: '#uppy-dashboard', // The element where Dashboard should be rendered
                height: 450,                // Adjust height as needed
                showProgressDetails: true,
                proudlyDisplayPoweredByUppy: true
            })
            .use(ImageEditor, { target: Dashboard })
            .use(RemoteSources, {
                companionUrl: 'https://api2.transloadit.com/companion',
            })
            .on('complete', ({ transloadit }) => {
                // Due to waitForEncoding:true this is fired after encoding is done.
                // Alternatively, set waitForEncoding to false and provide a notify_url
                console.log(transloadit) // Array of Assembly Statuses
                
                // Display results in the UI
                let resultText = 'Upload Complete!\n\n';
                
                transloadit.forEach((assembly, index) => {
                    resultText += `Assembly ${index + 1} ID: ${assembly.assembly_id}\n`;
                    resultText += `Results:\n${JSON.stringify(assembly.results, null, 2)}\n\n`;
                    console.log(assembly.results) // Array of all encoding results
                });
                
                resultsElement.textContent = resultText;
            })
            .on('error', (error) => {
                console.error(error);
                resultsElement.textContent = `Error: ${error.message || 'Unknown error'}`;
            });
            
        // You can also log when files are added
        uppy.on('file-added', (file) => {
            console.log('File added:', file.name);
        });
    </script>
</body>
</html>
